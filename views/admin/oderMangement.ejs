<%- include('./adminLayout/header') %>
<link rel="stylesheet" href="css/mystyle.css">
 <style>

 </style>
    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fab fa-wizards-of-the-coast" style="color: #ffffff;"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Wizcart<sup></sup></div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" href="/dashboard">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                Interface
            </div>

            <!-- Nav Item - Pages Collapse Menu -->

            <li class="nav-item">
                <a class="nav-link" href="/userList">
                    <i class="fas fa-fw fa fa-user"></i>
                  
                    <span>USER MANAGEMENT</span></a>
            </li>




            <!-- Nav Item - Utilities Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUtilities"
                    aria-expanded="true" aria-controls="collapseUtilities">
                    <i class="fas fa-box" style="color: #ffffff;"></i>
                    <span>PRODUCTS</span>
                </a>
                <div id="collapseUtilities" class="collapse" aria-labelledby="headingUtilities"
                    data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">product management</h6>
                        <a class="collapse-item" href="/addProduct">ADD NEW PRODUCT</a>
                        <a class="collapse-item" href="Products">EDIT PRODUCT</a>
                        <a class="collapse-item" href="Products">HIDE PRODUCT</a>
                        <a class="collapse-item" href="Products">DELETE PRODUCT</a>
                    </div>
                </div>
            </li>


          

                <li class="nav-item">
                    <a class="nav-link" href="/category">
                        <i class="fas fa-boxes" style="color: #ffffff;"></i>
                        <span>CATEGORY MANAGEMENT</span> </a>
                </li>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">CATEGORY</h6>
                        
                        
                        <a class="collapse-item" href="category"> CATEGORY</a>

                    </div>
                </div>
            </li>


            <!-- Divider -->
            <hr class="sidebar-divider">

            
            <div class="sidebar-heading">
                PORFILE
            </div>

            
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages">
                    <i class="fas fa-fw fa-folder"></i>
                    <span>PORFILE</span>
                </a>
                <div id="collapsePages" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">Login Screens:</h6>
                        <a class="collapse-item" href="/logout"><i class="fas fa-sign-out-alt" style="color: #000000;"></i>Logout </a>
                        <!-- <a class="collapse-item" href="register.html">Register</a>
                        <a class="collapse-item" href="forgot-password.html">Forgot Password</a>
                        <div class="collapse-divider"></div>
                        <h6 class="collapse-header">Other Pages:</h6>
                        <a class="collapse-item" href="404.html">404 Page</a>
                        <a class="collapse-item" href="blank.html">Blank Page</a> -->
                    </div>
                </div>
            </li>

            <!-- Nav Item - Charts -->
            <!-- <li class="nav-item">
                <a class="nav-link" href="charts.html">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>Charts</span></a>
            </li> -->

            
           

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

 

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">


                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

               
                </div>
               
<div class="container-fluid">
    <h2 class="mb-4">Product Orders</h2>
    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search...">

    <% if (orders.length === 0) { %>
        <div class="alert alert-info">
            <div class="card">
                <div class="card-body">
                    No orders found.
                </div>
            </div>
        </div>
    <% } else { %>
        <div class="table-responsive text-dark">
            <table class="table table-hover table-bordered">
                <thead class="table-dark">
                    <tr>
                      
                        <th>PRODUCT</th>
                        <th>quantity</th>
                        <th>USERNAME</th>
                        <th>STATUS</th>
                        <th>ORDER&nbspDATE</th>
                        <th>CUSTOMERS&nbspDETAILS</th>
                        <th>EDIT STATUS</th>
                       
                    </tr>
                </thead>
                <tbody>
                    <% orders.forEach((order, index) => { %>
                        <% order.product.forEach((product, index) => { %>
                            <% if (order.newone[index]) { %>
                                <tr class="<%= product.status.toLowerCase() === 'cancelled' ? 'table-danger' : product.status.toLowerCase() === 'pending' ? 'table-warning' : product.status.toLowerCase() === 'delivered' ? 'table-success' : '' %> align-middle">
                                   
                                    <td><%= order.newone[index].product_name || 'Product Name Not Available' %></td>
                                    <td><%= product.quantity %></td>
                                     
                                    <td><%= order.name %></td>
                                    <td><%= product.status %></td>
                                    <td><%= new Date(order.orderDate).toLocaleDateString() %></td>
                                    <td>
                                        <div class="address p-3 border rounded text-dark">
                                            <p>
                                                <strong>Name:</strong> <%= order.shipment_address.name %>, 
                                                <strong>Mobile:</strong> <%= order.shipment_address.mobile %>, 
                                                <strong>Pincode:</strong> <%= order.shipment_address.pincode %>, 
                                                <strong>Locality:</strong> <%= order.shipment_address.locality %>, 
                                                <strong>Address:</strong> <%= order.shipment_address.address %>, 
                                                <strong>City:</strong> <%= order.shipment_address.city %>, 
                                                <strong>State:</strong> <%= order.shipment_address.pincode %>, 
                                                <strong>Landmark:</strong> <%= order.shipment_address.landmark %>,                                             
                                                <strong>Address Type:</strong> <%= order.shipment_address.addresstype %>
                                            </p>
                                        </div>
                                    </td>
                                    <td>
                                        <form action="/update-status" method="POST" id="statusUpdate-<%= product._id %>">
                                            <input type="hidden" name="product_id" value="<%= product._id %>">
                                            <input type="hidden" name="object_id" value="<%= order._id %>">
                                            <select name="status" class="form-select">
                                                <option value="pending" <%= product.status.toLowerCase() === 'pending' ? 'selected' : '' %>>Pending</option>
                                                <option value="cancelled" <%= product.status.toLowerCase() === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                                                <option value="delivered" <%= product.status.toLowerCase() === 'delivered' ? 'selected' : '' %>>Delivered</option>
                                            </select>
                                            <button type="button" onclick="editStatus('<%= product._id %>')" class="btn btn-primary mt-2">Update</button>
                                        </form>
                                    </td>
                                    
                                </tr>
                            <% } %>
                        <% }) %>
                    <% }) %>
                </tbody>
            </table>
        </div>

        <!-- Pagination Controls -->
        <nav>
            <ul class="pagination">
                <% if (currentPage > 1) { %>
                    <li class="page-item">
                        <a class="page-link" href="/orderMangement?page=<%= currentPage - 1 %>&limit=<%= limit %>">Previous</a>
                    </li>
                <% } %>

                <% for (let i = 1; i <= totalPages; i++) { %>
                    <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                        <a class="page-link" href="/orderMangement?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
                    </li>
                <% } %>

                <% if (currentPage < totalPages) { %>
                    <li class="page-item">
                        <a class="page-link" href="/orderMangement?page=<%= currentPage + 1 %>&limit=<%= limit %>">Next</a>
                    </li>
                <% } %>
            </ul>
        </nav>
    <% } %>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: #f5f5f5;
    }
    .card-body {
        background: #f9f9f9;
    }
    .address {
        background: #f8f9fa;
    }
</style>

                
               
                
             
                


























            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Your Website 2020</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->


    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

   <script>
      
      function editStatus(productId) {
  Swal.fire({
    title: "Are you sure?",
    text: "Are you sure to edit the status",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#3085d6",
    cancelButtonColor: "#d33",
    confirmButtonText: "Yes, EDIT!"
  }).then((result) => {
    if (result.isConfirmed) {
      Swal.fire({
        title: "Updated",
        text: "Status has been updated.",
        icon: "success"
      }).then(() => {
        document.getElementById(`statusUpdate-${productId}`).submit();        
      });
    }
  });
}












document.getElementById("searchInput").addEventListener('keyup', function() {
            var filter = this.value.toLowerCase();
            var rows = document.querySelectorAll('table tbody tr');

            rows.forEach(function(row) {
                var text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });









    document.addEventListener('DOMContentLoaded', function() {
        var toast = document.getElementById('toast');
        if (toast) {
            toast.classList.add('show');
            // Hide the toast message after 3 seconds (3000 milliseconds)
            setTimeout(function() {
                toast.classList.remove('show');
            }, 7000);
        }
    });

   </script>
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/datatables-demo.js"></script>

    <%- include('./adminLayout/footer') %>

