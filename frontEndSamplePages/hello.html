<%- include('../layout/header') %>

<link rel="stylesheet" href="css/mystyle.css">

<div class="colorlib-loader"></div>

<div id="page">


  <nav class="colorlib-nav" role="navigation">
    <div class="top-menu">
      <div class="container">
        <div class="row">

          <div class="d-flex align-items-center col-sm-7 col-md-9 font-monospace">
            <i class="fa-brands fa-wizards-of-the-coast" style="color: #000000; font-size: 3rem;  "></i>
            <div id="colorlib-logo">Wizcart</div>
          </div>


          <div class="col-sm-5 col-md-3 " style="margin-left: -104px">
            <form action="" class="search-wrap">
              <div class="form-group">
                <input type="search" class="form-control search" style="margin-top: 5px; margin-left: 3px;" placeholder="Search">
                <button class="btn btn-primary submit-search text-center" style="margin-top: 27px; border-radius: 40px;" type="submit"><i class="icon-search"></i></button>
              </div>
            </form>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 text-left menu-1">
            <ul>
              <li class="active"><a>Home</a></li>

              <li><a href="">upcoming launches</a></li>
              <li><a href="">About</a></li>
              <li><a href="">Contact</a></li>


              <li class="cart">
                <a href="/cart">
                  <i class="icon-shopping-cart"></i>
                  CART

                  <% if (typeof cartQuantity !=='undefined' ) { %>

                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                    <%=cartQuantity%>




                    <span class="visually-hidden">unread messages</span>
                  </span>
                  <% } %>


                </a>
              </li>




              <% if (typeof user !=='undefined' ) { %>
              <div class="dropdown profile">
                <a class="btn  dropdown-toggle" style="background-color: #88c8bc98;" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fa-solid fa-user fa-bounce" style="color: #000000; font-size: 1.5rem;"></i>
                  <%= user.name %>
                </a>

                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                  <li><a class="dropdown-item" href="/profile"><i class="fa-solid fa-file-invoice"></i> MY ACCOUNT</a></li>
                  <li><a class="dropdown-item" href=""><i class="fa-solid fa-truck"></i> My
                      Orders</a></li>
                  <li><a class="dropdown-item" href=""><i class="fa-solid fa-heart"></i>
                      Wishlist</a></li>
                  <li><a class="dropdown-item" href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Log Out</a></li>
                </ul>
              </div>
              <% } else { %>

              <li class="has-dropdown profile " style="color: aliceblue;">
                <a href="login"><i class="fa-regular fa-beat-fade fa-user" style="color: #000000;"></i>LOGIN</a>
                <ul class="dropdown" style="background-color:#88c8bc;">
                  <li><a class="text-dark" href="login"><i class="fa-solid fa-wallet"></i>Login</a></li>
                  <!-- <li><a class="text-dark" href="order-complete.html"><i class="fa-solid fa-truck" style="color: #000000;"></i>my orders</a></li>
												<li><a class="text-dark" href="add-to-wishlist.html"><i class="fa-solid fa-heart" style="color: #000000;"></i>Wishlist</a></li>
												<li><a class="text-dark" href="product-detail.html"><i class="fa-solid fa-right-from-bracket" style="color: #000000;"></i>Log Out</a></li> -->
                </ul>
              </li>



              <% } %>
            </ul>
          </div>

        </div>
      </div>
    </div>
    <div class="sale">
      <div class="container">
        <div class="row">
          <div class="col-sm-8 offset-sm-2 text-center">
            <div class="row">
              <div class="owl-carousel2">
                <div class="item">
                  <div class="col">
                    <h3>.<a></a></h3>
                  </div>
                </div>
                <div class="item">
                  <div class="col">
                    <h3>.</a></h3>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <div class="breadcrumbs">
    <div class="container">
      <div class="row">
        <div class="col">
          <p class="bread"><span><a href="index.html">Home</a></span> / <span>Checkout</span></p>
        </div>
      </div>
    </div>
  </div>


  <div class="colorlib-product">
    <div class="container">
      <div class="row row-pb-lg">
        <div class="col-sm-10 offset-md-1">
          <div class="process-wrap">
            <div class="process text-center active">
              <p><span>01</span></p>
              <h3>Shopping Cart</h3>
            </div>
            <div class="process text-center active">
              <p><span>02</span></p>
              <h3>Checkout</h3>
            </div>
            <div class="process text-center">
              <p><span>03</span></p>
              <h3>Order Complete</h3>
            </div>
          </div>
        </div>
      </div>


      <div class="row">


        <div class="col-lg-8">

          <div class="col-12 ">
            <h2 class="bg-secondary text-white">products </h2>
            <br>
            <br>
            <hr>
            <div class="row">
              <% cartItems.forEach(item=> { %>

              <div class="product-cart d-flex">


                <div class="one-forth">
                  <div class="product-img" style="background-image: url(<%=item.productDetails.product_img[1]%>)">
                    <img src="<%= item.productDetails.product_img[0] %>" alt="<%= cartItems[0].productDetails.product_name %>">
                  </div>
                  <div class="display-tc ">
                    <h6 class="ml-5 pl-5 ">
                      <%= item.productDetails.product_name %>
                    </h6>
                  </div>
                </div>
                <div class="one-eight text-center">
                  <div class="display-tc">
                    <span class="price item-price">
                     <%= item.productDetails.price %>
                    </span>
                  </div>
                </div>
                <input type="text" class="productId" value="<%=item.productId%>" hidden>
                <div class="d-flex align-items-center">
                  <button type="button" class="btn btn-light decrement-btn" style="border: 0.5px solid rgb(56, 56, 56);">
                    <i class="fa-solid fa-minus" style="color: #000000;"></i>
                  </button>



                  <span class="quantity ml-1 mr-2">
                    <%=item.quantity%>
                  </span>

                  <button type="button" class="btn btn-light increment-btn" style="border: 0.5px solid rgb(56, 56, 56);">
                    <i class="fa-solid fa-plus" style="color: #000000;"></i>
                  </button>


                </div>
                <div class="one-eight text-center">
                  <div class="display-tc">
                    <span class="price total-price ">
                      <%= item.quantity * item.productDetails.price %>
                    </span>
                  </div>
                </div>
                <div class="one-eight text-center">
                  <div class="display-tc">
                    <input type="text" id="removeId" hidden value="<%=item.productId%>">
                    <a id="removeItem" class="closed"></a>
                  </div>
                </div>
              </div>
              <% }) %>





            </div>




            <h2 class="bg-secondary text-white mt-5">shipping address</h2>
            <br>
            <br>
            <hr>
        <% user.address.forEach((e,i)=> { %>



            <div class="card col-md-12 mt-3">
              <div class="card-header d-flex justify-content-between align-items-center">
                <div class="d-flex flex-row">
                  <strong>
                    <%=e.name%>
                  </strong>
                  <%=e.mobile%>

                </div>
                <div class="dropdown">
                  <button class="btn btn-link" style="color: #88c8bc;" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <li><a class="dropdown-item edit-btn" data-index='<%= JSON.stringify([i,e.name, e.mobile, e.pincode, e.locality, e.address, e.city, e.state, e.landmark, e.altmobile, e.addresstype]) %>' data-bs-toggle="modal" data-bs-target="#exampleModal" href="#">Edit</a></li>
                    <li><a class="dropdown-item" onclick="deleteCofo()"> Delete</a> <input hidden type="number" id="index" value="<%=i %>"></li>

                  </ul>
                </div>
              </div>
              <div class="card-body">
                <%=`${e.name}, ${e.mobile}, ${e.pincode},
											address${e.address},${e.city},${e.state} `%>
              </div>
            </div>

            <% }) %>





          </div>

        </div>

        <div class="col-lg-4">
          <div class="row">
            <div class="col-md-12">
              <div class="cart-detail">
                <h2>Cart Total</h2>
                <ul>
                  <li>
                    <span>Subtotal</span> <span>₹<%=totalAmount %></span>
                    <ul>
                      <% cartItems.forEach(item=> { %>

                      <li><span class="single-itemPrice">
                          <%= item.productDetails.product_name %>(x<%=item.quantity%>)
                        </span> <span class="price total-price ">₹ <%= item.quantity *item.productDetails.price %></span></li>
                      <% }) %>

                    </ul>
                  </li>
                  <li><span>Shipping</span> <span>$0.00</span></li>
                  <li>
                    <p><span class="pd-priceTitle">Order Total</span><span id="pd-Total">
                        <%=totalAmount %>
                      </span></p>
                  </li>

                </ul>
              </div>
            </div>

            <div class="w-100"></div>

            <div class="col-md-12">
              <div class="cart-detail">
                <h2>Payment Method</h2>
                <div class="form-group">
                  <div class="col-md-12">
                    <div class="radio">
                      <label><input type="radio" name="optradio"> Direct Bank Tranfer</label>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-md-12">
                    <div class="radio">
                      <label><input type="radio" name="optradio"> Check Payment</label>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-md-12">
                    <div class="radio">
                      <label><input type="radio" name="optradio"> Paypal</label>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-md-12">
                    <div class="checkbox">
                      <label><input type="checkbox" value=""> I have read and accept the terms
                        and conditions</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 text-center">
              <p><a href="#" class="btn btn-primary">Place an order</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer id="colorlib-footer" role="contentinfo">
    <div class="container">
      <div class="row row-pb-md">
        <div class="col footer-col colorlib-widget">
          <h4>About Footwear</h4>
          <p>Even the all-powerful Pointing has no control about the blind texts it is an almost
            unorthographic life</p>
          <p>
          <ul class="colorlib-social-icons">
            <li><a href="#"><i class="icon-twitter"></i></a></li>
            <li><a href="#"><i class="icon-facebook"></i></a></li>
            <li><a href="#"><i class="icon-linkedin"></i></a></li>
            <li><a href="#"><i class="icon-dribbble"></i></a></li>
          </ul>
          </p>
        </div>
        <div class="col footer-col colorlib-widget">
          <h4>Customer Care</h4>
          <p>
          <ul class="colorlib-footer-links">
            <li><a href="#">Contact</a></li>
            <li><a href="#">Returns/Exchange</a></li>
            <li><a href="#">Gift Voucher</a></li>
            <li><a href="#">Wishlist</a></li>
            <li><a href="#">Special</a></li>
            <li><a href="#">Customer Services</a></li>
            <li><a href="#">Site maps</a></li>
          </ul>
          </p>
        </div>
        <div class="col footer-col colorlib-widget">
          <h4>Information</h4>
          <p>
          <ul class="colorlib-footer-links">
            <li><a href="#">About us</a></li>
            <li><a href="#">Delivery Information</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Support</a></li>
            <li><a href="#">Order Tracking</a></li>
          </ul>
          </p>
        </div>

        <div class="col footer-col">
          <h4>News</h4>
          <ul class="colorlib-footer-links">
            <li><a href="blog.html">Blog</a></li>
            <li><a href="#">Press</a></li>
            <li><a href="#">Exhibitions</a></li>
          </ul>
        </div>

        <div class="col footer-col">
          <h4>Contact Information</h4>
          <ul class="colorlib-footer-links">
            <li>291 South 21th Street, <br> Suite 721 New York NY 10016</li>
            <li><a href="tel://1234567920">+ 1235 2355 98</a></li>
            <li><a href="mailto:info@yoursite.com">info@yoursite.com</a></li>
            <li><a href="#">yoursite.com</a></li>
          </ul>
        </div>
      </div>
    </div>


</div>



<div class="copy">
  <div class="row">
    <div class="col-sm-12 text-center">
      <p>
        <span>
          <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          Copyright &copy;
          <script>
            document.write(new Date().getFullYear());
          </script> All rights reserved | This template
          is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
          <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
        </span>
        <span class="block">Demo Images: <a href="http://unsplash.co/" target="_blank">Unsplash</a> , <a href="http://pexels.com/" target="_blank">Pexels.com</a></span>
      </p>
    </div>
  </div>
</div>
</footer>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="ion-ios-arrow-up"></i></a>
</div>





<script>
  function calculateGrandTotal() {
    let grandTotal = 0;
    document.querySelectorAll('.total-price').forEach(function(element) {
      grandTotal += parseFloat(element.innerText);
    });
    document.getElementById('pd-Total').innerText = grandTotal.toFixed(2);
    document.getElementById('total-afterDiscount').innerText = grandTotal.toFixed(2);

  }

  document.querySelectorAll('.decrement-btn').forEach(button => {
    button.addEventListener('click', function() {
      const quantityElement = this.nextElementSibling;
      let currentQuantity = parseInt(quantityElement.innerText, 10);
      const itemPriceElement = this.closest('.product-cart').querySelector('.item-price');
      const totalPriceElement = this.closest('.product-cart').querySelector('.total-price');
      let itemPrice = parseFloat(itemPriceElement.innerText);

      if (currentQuantity > 1) {
        currentQuantity--;
        quantityElement.innerText = currentQuantity;
        const productId = this.closest('.product-cart').querySelector('.productId').value;


        quantitiySent(productId, 'dec');
        totalPriceElement.innerText = (currentQuantity * itemPrice).toFixed(2);

		
        calculateGrandTotal();
		

        Swal.fire({
          position: "bottom",
          title: " ✅ quantity updated",
          showConfirmButton: false,
          timer: 1200,
          customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            icon: 'custom-swal-icon'
          }
        })

      }
    });
  });

  document.querySelectorAll('.increment-btn').forEach(button => {
    button.addEventListener('click', function() {
      const quantityElement = this.previousElementSibling;
      let currentQuantity = parseInt(quantityElement.innerText, 10);
      const itemPriceElement = this.closest('.product-cart').querySelector('.item-price');
      const totalPriceElement = this.closest('.product-cart').querySelector('.total-price');
      let itemPrice = parseFloat(itemPriceElement.innerText);

      if (currentQuantity < 10) {
        currentQuantity++;
        quantityElement.innerText = currentQuantity;
        const productId = this.closest('.product-cart').querySelector('.productId').value;

        quantitiySent(productId, 'inc');

        totalPriceElement.innerText = (currentQuantity * itemPrice).toFixed(2);
        calculateGrandTotal();
        Swal.fire({
          position: "bottom",
          title: " ✅ quantity updated",
          showConfirmButton: false,
          timer: 1200,
          customClass: {
            popup: 'custom-swal-popup',
            title: 'custom-swal-title',
            icon: 'custom-swal-icon'
          }
        })
      }
    });
  });

  function quantitiySent(productId, currentQuantity) {
    const data = {
      product_id: productId,
      currentQuantity: currentQuantity
    };

    fetch('/quantityUpdate', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => {
        if (!response.ok) {
			
          throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
      })
      .then(data => {
        console.log('Success:', data);
      })
      .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
      });
  }

  // Initial calculation of grand total
  calculateGrandTotal();




  document.getElementById('removeItem').addEventListener('click', (e) => {
    Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#4CAF50",
      cancelButtonColor: "#f44336",
      confirmButtonText: "Yes, delete it!",
      background: '#333',
      color: '#fff',
      customClass: {
        confirmButton: 'custom-confirm-button-class',
        cancelButton: 'custom-cancel-button-class'
      }
    }).then((result) => {
      if (result.isConfirmed) {
        const removeId = document.getElementById('removeId').value;
        const formData = {};

        fetch(`/removeItem/id${removeId}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          })
          .then(response => {
            if (!response.ok) {
              return response.json().then(errorData => {
                throw new Error(errorData.message || 'Network response was not ok');
              });
            }
            return response.json();
          })
          .then(data => {
            console.log('Item removed successfully:', data);

            Swal.fire({
              position: "bottom",
              text: "Successfully removed from your cart",
              showConfirmButton: false,
              timer: 1500,
              customClass: {
                popup: 'custom-swal-popup',
                text: 'custom-swal-text',
                icon: 'custom-swal-icon'
              }
            }).then(() => {
              window.location.href = '/cart';
            });
          })
          .catch(error => {
            console.error('There was an error removing the item:', error);
            Swal.fire({
              icon: 'error',
              title: 'Oops...',
              text: 'Error removing item: ' + error.message,
              background: '#333',
              color: '#fff'
            });
          });
      }
    });
  });
</script>





<!-- jQuery -->
<script src="js/jquery.min.js"></script>
<!-- popper -->
<script src="js/popper.min.js"></script>
<!-- bootstrap 4.1 -->
<script src="js/bootstrap.min.js"></script>
<!-- jQuery easing -->
<script src="js/jquery.easing.1.3.js"></script>
<!-- Waypoints -->
<script src="js/jquery.waypoints.min.js"></script>
<!-- Flexslider -->
<script src="js/jquery.flexslider-min.js"></script>
<!-- Owl carousel -->
<script src="js/owl.carousel.min.js"></script>
<!-- Magnific Popup -->
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/magnific-popup-options.js"></script>
<!-- Date Picker -->
<script src="js/bootstrap-datepicker.js"></script>
<!-- Stellar Parallax -->
<script src="js/jquery.stellar.min.js"></script>
<!-- Main -->
<script src="js/main.js"></script>

</body>

</html>